<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health First Aid</title>
    <!-- Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –®—Ä–∏—Ñ—Ç Inter –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Tone.js –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–≤—É–∫–æ–≤ -->
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to top, #6a11cb 0%, #2575fc 100%);
        }
        .page-transition-enter { opacity: 0; transform: translateY(20px); }
        .page-transition-enter-active { opacity: 1; transform: translateY(0); transition: opacity 300ms ease-out, transform 300ms ease-out; }
        .page-transition-exit { opacity: 1; transform: translateY(0); }
        .page-transition-exit-active { opacity: 0; transform: translateY(-20px); transition: opacity 300ms ease-in, transform 300ms ease-in; }
        .breathing-light-container {
            position: relative;
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .breathing-light {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
            animation: lightPulse 10s ease-in-out infinite;
        }
        @keyframes lightPulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        canvas {
            touch-action: none;
            cursor: none;
        }
        @media (max-width: 640px) {
            .breathing-light-container {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 antialiased text-gray-800">
    <div id="root" class="w-full max-w-lg bg-white bg-opacity-95 backdrop-blur-sm rounded-3xl shadow-2xl p-8 flex flex-col">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –∑–¥–µ—Å—å —Å –ø–æ–º–æ—â—å—é JavaScript -->
    </div>
    
    <script>
        // –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const root = document.getElementById('root');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ö–æ–¥–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        let currentPage = 'menu';
        let breathingInterval = null;
        let mazeCanvas, mazeCtx, mazeWidth, mazeHeight, mazePlayerX, mazePlayerY, mazeGrid, mazeCellSize;
        let soundscapeVolumeControls = {};
        
        // –û–±—ä–µ–∫—Ç –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
        const pages = {
            menu: 'menu',
            breathing: 'breathing',
            maze: 'maze',
            soundscape: 'soundscape'
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–†–ê–ù–ò–¶–ê–ú–ò –ò –°–û–°–¢–û–Ø–ù–ò–ï–ú ---
        
        const render = (page) => {
            // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
            stopAllSounds();

            const pageElement = document.createElement('div');
            pageElement.className = 'page-transition-enter absolute w-full p-4';
            
            const transitionOut = () => {
                const oldPage = root.querySelector('.page-transition-enter-active');
                if (oldPage) {
                    oldPage.className = 'page-transition-exit-active absolute w-full p-4';
                    setTimeout(() => oldPage.remove(), 300);
                }
            };
            
            transitionOut();

            setTimeout(() => {
                let content = '';
                switch (page) {
                    case pages.menu:
                        content = `
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-extrabold text-blue-900">
                                    <span class="inline-block h-10 w-10 text-violet-500 mr-2">üß†</span>
                                    M.H. First Aid
                                </h1>
                                <p class="text-gray-600 mt-2 text-lg">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º–æ–ø–æ–º–æ—â–∏</p>
                            </div>
                            <div class="grid grid-cols-1 gap-4">
                                <button onclick="changePage('breathing')" class="flex items-center bg-white hover:bg-violet-50 active:bg-violet-100 transition-colors duration-200 rounded-2xl p-6 shadow-md hover:shadow-xl transform hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-violet-300">
                                    <div class="bg-violet-100 text-violet-600 p-3 rounded-full mr-4 flex-shrink-0">üå¨Ô∏è</div>
                                    <div class="text-left flex-grow">
                                        <h3 class="text-xl font-bold">–î—ã—Ö–∞–Ω–∏–µ –°–≤–µ—Ç–∞</h3>
                                        <p class="text-gray-500 mt-1 text-sm">–í–∏–∑—É–∞–ª—å–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –¥–ª—è —É—Å–ø–æ–∫–æ–µ–Ω–∏—è –¥—ã—Ö–∞–Ω–∏—è.</p>
                                    </div>
                                </button>
                                <button onclick="changePage('maze')" class="flex items-center bg-white hover:bg-violet-50 active:bg-violet-100 transition-colors duration-200 rounded-2xl p-6 shadow-md hover:shadow-xl transform hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-violet-300">
                                    <div class="bg-violet-100 text-violet-600 p-3 rounded-full mr-4 flex-shrink-0"> labyrinth </div>
                                    <div class="text-left flex-grow">
                                        <h3 class="text-xl font-bold">–õ–∞–±–∏—Ä–∏–Ω—Ç –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
                                        <p class="text-gray-500 mt-1 text-sm">–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ñ–æ–∫—É—Å–∞ –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è.</p>
                                    </div>
                                </button>
                                <button onclick="changePage('soundscape')" class="flex items-center bg-white hover:bg-violet-50 active:bg-violet-100 transition-colors duration-200 rounded-2xl p-6 shadow-md hover:shadow-xl transform hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-violet-300">
                                    <div class="bg-violet-100 text-violet-600 p-3 rounded-full mr-4 flex-shrink-0">üéß</div>
                                    <div class="text-left flex-grow">
                                        <h3 class="text-xl font-bold">–ó–≤—É–∫–∏ –ü—Ä–∏—Ä–æ–¥—ã</h3>
                                        <p class="text-gray-500 mt-1 text-sm">–°–æ–∑–¥–∞–π —Å–≤–æ—é —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â—É—é –∑–≤—É–∫–æ–≤—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.</p>
                                    </div>
                                </button>
                            </div>
                            <footer class="mt-8 text-center text-gray-500 text-sm w-full">
                                <p>–≠—Ç–æ –Ω–µ –∑–∞–º–µ–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ—Ä–∞–ø–µ–≤—Ç—É.</p>
                            </footer>
                        `;
                        break;
                    case pages.breathing:
                        content = `
                            <div class="w-full text-center flex flex-col items-center p-4">
                                <h2 class="text-3xl font-bold text-blue-900 mb-4">–î—ã—Ö–∞–Ω–∏–µ –°–≤–µ—Ç–∞</h2>
                                <p class="text-gray-600 mb-8">
                                    –í–¥—ã—Ö–∞–π, –∫–æ–≥–¥–∞ —Å–≤–µ—Ç —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è, –∏ –≤—ã–¥—ã—Ö–∞–π, –∫–æ–≥–¥–∞ –æ–Ω —Å–∂–∏–º–∞–µ—Ç—Å—è. –°–ª–µ–¥—É–π –∑–∞ –Ω–∏–º, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Å–≤–æ–π —Ä–∏—Ç–º.
                                </p>
                                <div class="breathing-light-container mb-8">
                                    <div id="breathing-light" class="breathing-light"></div>
                                    <div id="breathing-text" class="absolute font-extrabold text-2xl text-blue-900">–ù–∞—á–∞—Ç—å</div>
                                </div>
                                <button id="breathing-button" onclick="startBreathing()" class="w-full bg-violet-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-violet-700 transition-colors duration-200 transform hover:-translate-y-1">
                                    –ù–∞—á–∞—Ç—å
                                </button>
                                <button onclick="changePage('menu')" class="mt-4 w-full bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-300 transition-colors duration-200 transform hover:-translate-y-1">
                                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                                </button>
                            </div>
                        `;
                        break;
                    case pages.maze:
                        content = `
                            <div class="w-full text-center flex flex-col items-center p-4">
                                <h2 class="text-3xl font-bold text-blue-900 mb-4">–õ–∞–±–∏—Ä–∏–Ω—Ç –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h2>
                                <p class="text-gray-600 mb-4">
                                    –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –ø—É—Ç–∏ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–≥–∞–π—Å—è –∫ —Ñ–∏–Ω–∏—à—É. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –∏–ª–∏ –ø—Ä–æ–≤–µ–¥–∏ –ø–∞–ª—å—Ü–µ–º –ø–æ —ç–∫—Ä–∞–Ω—É.
                                </p>
                                <div class="relative w-full max-w-sm aspect-square bg-gray-100 rounded-lg shadow-inner border border-gray-300">
                                    <canvas id="maze-canvas" class="w-full h-full"></canvas>
                                </div>
                                <div class="mt-4 flex space-x-4">
                                    <button onclick="changePage('menu')" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-300 transition-colors duration-200 transform hover:-translate-y-1">
                                        –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                                    </button>
                                    <button onclick="initMaze()" class="w-full bg-violet-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-violet-700 transition-colors duration-200 transform hover:-translate-y-1">
                                        –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
                                    </button>
                                </div>
                            </div>
                        `;
                        break;
                    case pages.soundscape:
                        content = `
                            <div class="w-full text-center flex flex-col items-center p-4">
                                <h2 class="text-3xl font-bold text-blue-900 mb-4">–ó–≤—É–∫–∏ –ü—Ä–∏—Ä–æ–¥—ã</h2>
                                <p class="text-gray-600 mb-8">
                                    –ù–∞—Å—Ç—Ä–æ–π —Å–≤–æ—é –∏–¥–µ–∞–ª—å–Ω—É—é –∑–≤—É–∫–æ–≤—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É, —Ä–µ–≥—É–ª–∏—Ä—É—è –≥—Ä–æ–º–∫–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö –∑–≤—É–∫–æ–≤.
                                </p>
                                <div id="sound-controls" class="w-full grid grid-cols-1 gap-6">
                                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JavaScript -->
                                </div>
                                <button onclick="changePage('menu')" class="mt-8 w-full bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-300 transition-colors duration-200 transform hover:-translate-y-1">
                                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                                </button>
                            </div>
                        `;
                        break;
                }

                pageElement.innerHTML = content;
                root.appendChild(pageElement);
                setTimeout(() => {
                    pageElement.className = 'page-transition-enter-active absolute w-full p-4';
                    // –ó–∞–ø—É—Å–∫ –ª–æ–≥–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    if (page === pages.maze) initMaze();
                    if (page === pages.soundscape) initSoundscape();
                }, 10);
            }, 300);
        };
        
        const changePage = (pageName) => {
            currentPage = pageName;
            render(currentPage);
        };

        // --- –õ–û–ì–ò–ö–ê –ò–ì–† ---

        // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ "–î—ã—Ö–∞–Ω–∏–µ –°–≤–µ—Ç–∞"
        const startBreathing = () => {
            const breathingLight = document.getElementById('breathing-light');
            const breathingText = document.getElementById('breathing-text');
            const button = document.getElementById('breathing-button');
            
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
                breathingLight.style.animationPlayState = 'paused';
                breathingLight.style.animation = 'none';
                breathingText.innerText = '–ù–∞—á–∞—Ç—å';
                button.innerText = '–ù–∞—á–∞—Ç—å';
                return;
            }
            
            breathingLight.style.animation = 'lightPulse 10s ease-in-out infinite';
            breathingText.innerText = '–î—ã—à–∏';
            button.innerText = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';

            breathingInterval = setInterval(() => {
                const now = performance.now();
                const cycleTime = now % 10000;
                if (cycleTime < 4000) { // 4s –≤–¥–æ—Ö
                    breathingText.innerText = '–í–¥–æ—Ö';
                } else { // 6s –≤—ã–¥–æ—Ö
                    breathingText.innerText = '–í—ã–¥–æ—Ö';
                }
            }, 500);
        };

        // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ "–õ–∞–±–∏—Ä–∏–Ω—Ç –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
        const initMaze = () => {
            mazeCanvas = document.getElementById('maze-canvas');
            if (!mazeCanvas) return;
            mazeCtx = mazeCanvas.getContext('2d');
            const container = mazeCanvas.parentElement;
            mazeWidth = container.offsetWidth;
            mazeHeight = container.offsetHeight;
            mazeCanvas.width = mazeWidth;
            mazeCanvas.height = mazeHeight;
            window.addEventListener('resize', () => {
                mazeWidth = container.offsetWidth;
                mazeHeight = container.offsetHeight;
                mazeCanvas.width = mazeWidth;
                mazeCanvas.height = mazeHeight;
                // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∞–±–∏—Ä–∏–Ω—Ç–∞ –∏–ª–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è
                generateAndDrawMaze();
            });

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
            const cols = 15;
            const rows = 15;
            mazeCellSize = mazeWidth / cols;
            mazePlayerX = 0;
            mazePlayerY = 0;
            
            // –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
            mazeGrid = [];
            for (let j = 0; j < rows; j++) {
                mazeGrid[j] = [];
                for (let i = 0; i < cols; i++) {
                    mazeGrid[j][i] = {
                        walls: { top: true, right: true, bottom: true, left: true },
                        visited: false
                    };
                }
            }
            
            const stack = [];
            let current = mazeGrid[mazePlayerY][mazePlayerX];
            current.visited = true;
            stack.push(current);
            
            while (stack.length > 0) {
                const neighbors = [];
                const x = mazeGrid[0].indexOf(current);
                const y = mazeGrid.indexOf(mazeGrid.find(row => row.includes(current)));

                if (y > 0 && !mazeGrid[y - 1][x].visited) neighbors.push(mazeGrid[y - 1][x]);
                if (x < cols - 1 && !mazeGrid[y][x + 1].visited) neighbors.push(mazeGrid[y][x + 1]);
                if (y < rows - 1 && !mazeGrid[y + 1][x].visited) neighbors.push(mazeGrid[y + 1][x]);
                if (x > 0 && !mazeGrid[y][x - 1].visited) neighbors.push(mazeGrid[y][x - 1]);
                
                if (neighbors.length > 0) {
                    const next = neighbors[Math.floor(Math.random() * neighbors.length)];
                    stack.push(current);
                    
                    if (next === mazeGrid[y - 1][x]) { // Top
                        current.walls.top = false;
                        next.walls.bottom = false;
                    } else if (next === mazeGrid[y][x + 1]) { // Right
                        current.walls.right = false;
                        next.walls.left = false;
                    } else if (next === mazeGrid[y + 1][x]) { // Bottom
                        current.walls.bottom = false;
                        next.walls.top = false;
                    } else if (next === mazeGrid[y][x - 1]) { // Left
                        current.walls.left = false;
                        next.walls.right = false;
                    }
                    
                    current = next;
                    current.visited = true;
                } else {
                    current = stack.pop();
                }
            }
            
            generateAndDrawMaze();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const movePlayer = (dx, dy) => {
                const newX = mazePlayerX + dx;
                const newY = mazePlayerY + dy;
                const currentCell = mazeGrid[mazePlayerY][mazePlayerX];
                
                let canMove = false;
                if (dx === 1 && !currentCell.walls.right) canMove = true;
                if (dx === -1 && !currentCell.walls.left) canMove = true;
                if (dy === 1 && !currentCell.walls.bottom) canMove = true;
                if (dy === -1 && !currentCell.walls.top) canMove = true;

                if (canMove && newX >= 0 && newX < cols && newY >= 0 && newY < rows) {
                    mazePlayerX = newX;
                    mazePlayerY = newY;
                    drawMaze();
                }
            };
            
            document.addEventListener('keydown', (e) => {
                if (currentPage !== pages.maze) return;
                switch (e.key) {
                    case 'ArrowUp': movePlayer(0, -1); break;
                    case 'ArrowDown': movePlayer(0, 1); break;
                    case 'ArrowLeft': movePlayer(-1, 0); break;
                    case 'ArrowRight': movePlayer(1, 0); break;
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            let touchStartX = 0;
            let touchStartY = 0;
            
            mazeCanvas.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, false);

            mazeCanvas.addEventListener('touchend', (e) => {
                if (currentPage !== pages.maze) return;
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;

                const dx = touchEndX - touchStartX;
                const dy = touchEndY - touchStartY;

                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > 0) movePlayer(1, 0); // Swipe right
                    else movePlayer(-1, 0); // Swipe left
                } else {
                    if (dy > 0) movePlayer(0, 1); // Swipe down
                    else movePlayer(0, -1); // Swipe up
                }
            }, false);
        };
        
        const drawMaze = () => {
            if (!mazeCtx) return;
            mazeCtx.clearRect(0, 0, mazeCanvas.width, mazeCanvas.height);
            mazeCtx.lineWidth = 2;
            mazeCtx.strokeStyle = '#2575fc';
            
            for (let j = 0; j < mazeGrid.length; j++) {
                for (let i = 0; i < mazeGrid[j].length; i++) {
                    const cell = mazeGrid[j][i];
                    const x = i * mazeCellSize;
                    const y = j * mazeCellSize;
                    
                    if (cell.walls.top) { mazeCtx.beginPath(); mazeCtx.moveTo(x, y); mazeCtx.lineTo(x + mazeCellSize, y); mazeCtx.stroke(); }
                    if (cell.walls.right) { mazeCtx.beginPath(); mazeCtx.moveTo(x + mazeCellSize, y); mazeCtx.lineTo(x + mazeCellSize, y + mazeCellSize); mazeCtx.stroke(); }
                    if (cell.walls.bottom) { mazeCtx.beginPath(); mazeCtx.moveTo(x + mazeCellSize, y + mazeCellSize); mazeCtx.lineTo(x, y + mazeCellSize); mazeCtx.stroke(); }
                    if (cell.walls.left) { mazeCtx.beginPath(); mazeCtx.moveTo(x, y + mazeCellSize); mazeCtx.lineTo(x, y); mazeCtx.stroke(); }
                }
            }
            
            // –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ñ–∏–Ω–∏—à
            mazeCtx.fillStyle = '#6a11cb';
            mazeCtx.fillRect(mazeCellSize * (mazeGrid[0].length - 1), mazeCellSize * (mazeGrid.length - 1), mazeCellSize, mazeCellSize);
            
            // –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞
            mazeCtx.fillStyle = '#fa71cd';
            mazeCtx.beginPath();
            mazeCtx.arc(mazePlayerX * mazeCellSize + mazeCellSize / 2, mazePlayerY * mazeCellSize + mazeCellSize / 2, mazeCellSize / 4, 0, Math.PI * 2);
            mazeCtx.fill();
        };

        const generateAndDrawMaze = () => {
             // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –ª–∞–±–∏—Ä–∏–Ω—Ç.
             // –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç drawMaze.
             // –î–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç—É—Ç –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é.
             drawMaze();
        };

        // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ "–ó–≤—É–∫–∏ –ü—Ä–∏—Ä–æ–¥—ã"
        const sounds = {
            rain: new Tone.NoiseSynth().toDestination(),
            forest: new Tone.Synth().toDestination(),
            waves: new Tone.AMSynth().toDestination()
        };
        const soundNames = {
            rain: '–î–æ–∂–¥—å',
            forest: '–õ–µ—Å (–ø—Ç–∏—Ü—ã)',
            waves: '–ú–æ—Ä—Å–∫–∏–µ –≤–æ–ª–Ω—ã'
        };

        const initSoundscape = () => {
            const controlsContainer = document.getElementById('sound-controls');
            if (!controlsContainer) return;

            for (const key in sounds) {
                const sound = sounds[key];
                const name = soundNames[key];
                
                sound.volume.value = -Infinity; // Mute by default
                sound.triggerAttack();

                const controlElement = document.createElement('div');
                controlElement.className = 'flex items-center space-x-4';
                controlElement.innerHTML = `
                    <div class="flex-shrink-0 w-12 text-2xl">${key === 'rain' ? 'üåßÔ∏è' : key === 'forest' ? 'üå≥' : 'üåä'}</div>
                    <span class="flex-grow font-bold text-lg">${name}</span>
                    <input type="range" min="-30" max="0" value="-30" class="flex-grow w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="volume-${key}">
                `;
                controlsContainer.appendChild(controlElement);
                
                const volumeInput = document.getElementById(`volume-${key}`);
                soundscapeVolumeControls[key] = volumeInput;

                volumeInput.addEventListener('input', (e) => {
                    const volume = parseFloat(e.target.value);
                    if (volume === -30) {
                        sound.volume.value = -Infinity;
                    } else {
                        sound.volume.value = volume;
                    }
                });
            }
        };

        const stopAllSounds = () => {
            for (const key in sounds) {
                sounds[key].triggerRelease();
            }
        };

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è HTML
        window.changePage = changePage;
        window.startBreathing = startBreathing;
        window.initMaze = initMaze;
        window.initSoundscape = initSoundscape;

        // –ó–∞–ø—É—Å–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            render(currentPage);
        });
    </script>
</body>
</html>
